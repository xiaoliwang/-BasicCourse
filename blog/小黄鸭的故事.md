# 小黄鸭的情侣王国

> 很久很久以前，有一个FF团成员(单身狗)悄悄潜伏在情侣之国，伺机准备对情侣们进行残酷报复。王子大人小黄鸭对此素手无策。唯一知道的是情侣之国中的每一对情侣都有相同且唯一的编码，而单身狗伪造的编码与所有人的编码都不相同。这时，小黄鸭大人找到了潜心学习算法的我，希望我能帮助他们找到FF团成员，并将其放逐。。。

当小黄鸭大人第一次找到我的时候，我觉得要解决这个问题还挺简单的。我准备将所有的用户编码都导入一个数组，然后用一个map记录他们的数量，最后找到那个只有一个的编码，这样就可以确认那个FF团成员。我构建的代码如下：

```js
var singleNumber = function(nums) {
	var map = {};
	var len = nums.length;
	for (var i = 0; i < len; i++){
		if(map[nums[i]]){
			map[nums[i]] = 2;
		}else{
			map[nums[i]] = 1;
		}
	}

	for(var j in map){
		if(map[j] === 1){
			return parseInt(j);
		}
	}
};
```

正当我自鸣得意，准备向小黄鸭大人炫耀的时候。我惊讶的发现，原来情侣之国的情侣众多，在导入数组后，完全没有多余的空间申明一个map来记录数量。我开始陷入了深深的沉思，却没有任何进展。思索间，不觉困意袭来，竟悄然步入梦中。恍惚间，忽见师傅立于我前，用严厉的语气对我说，“小李，近日可曾用功。”，忽然旧时的不少功夫浮现眼前，其中一个叫情侣克星的内功心法，在我面前尤其闪烁——异或，这是可以让所有情侣化整为零的功夫。如果我将所有情侣都化整为零，那剩下的不就是我们苦苦寻找的单身狗了吗？我迫不及待的写下代码并开始运行：

```js
var singleNumber = function(nums) {
	var result = 0;
	var len = nums.length;
	for (var i = 0; i < len; i++){
		result ^= nums[i];
	}
	return result;
};
```

最终，我们将FF团成员绳之以法。而我也获得英雄般的礼遇。

经过三年的分平浪静，情侣之国的人们再也不满足于成双成对。他们开始大玩3p，随之而来的是情侣治国变成了3p之国。而他们身上的编码，也变成了三个人拥有相同且唯一的编码。而FF团再次蠢蠢欲动，派出了他们的王牌潜伏进了3p之国，准备制造一个大新闻。

这一天，曾经的王子小黄鸭，现在的3p之国国王小绿鸭突然急匆匆的来到我家，告诉我他们发现了FF团的动向，并已经有确切消息，有FF团间谍已经潜伏下来。并希望我能再一次拯救世界。我看着一天天变绿的国王，想起了不少往事。不过直邮驰骋疆场，寻找单身狗，才能激起我的雄心壮志。只不过这次碰到的困难相较之过去碰到的困难，要更加困难的多。

首先我想到的还是，应该将所有人的编码都置于一个数组中，然后将每三个相同的数字都化整为零。这样剩下的一个就是FF团王牌的编码。

```js
var singleNumber = function(nums) {
	var ones = 0, twos = 0,mask = 0;
	var len = nums.length;
	for (var i = 0; i < len; i++){
		twos ^= ones & nums[i];
		ones ^= nums[i];
		mask = ~(twos & ones);
		twos &= mask;
		ones &= mask;
	}
	return ones;
};
```

当我们将数字处理完之后，我们惊讶的发现，返回的居然是0，而当我怀疑代码是否写错，并将twos返回时。我惊讶的发现编码竟与国王背后的护卫zz和小蘑菇完全一致。FF团这次潜伏下来的不是一个人，而是两个人。我看到他们用利刃，一步步的逼退我和小绿鸭。。。

各位听众一定十分好奇，为什么今天我还能站在这里给大家讲这个故事。因为他们似乎忘了，我还有一个特殊身份———香港记者。


